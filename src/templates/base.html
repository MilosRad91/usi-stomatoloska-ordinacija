<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Stomatološka ordinacija{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="https://cdn-icons-png.flaticon.com/512/1005/1005738.png" width="40" height="40" class="me-2">
                <span class="fs-4 fw-bold">Stomatološka ordinacija <span class="text-warning">Zdrav Osmeh</span></span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            {% if 'role' in session %}
            {% if session['role'] == 'pacijent' %}
            <div class="collapse navbar-collapse" id="navMenu">

                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link" href="/profil">Moj profil</a></li>
                    <li class="nav-item"><a class="nav-link" href="/zakazi_termin">Zakazivanje termina</a></li>
                    <li class="nav-item"><a class="nav-link" href="/cenovnik">Cenovnik usluga</a></li>
                </ul>

                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-warning fw-bold" href="/logout">Logout</a>
                    </li>
                </ul>

            </div>
            {% endif %}
            {% if session['role'] == 'stomatolog' %}
            <div class="collapse navbar-collapse" id="navMenu">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/pocetna_stranica">Početna</a></li>
                    <li class="nav-item"><a class="nav-link" href="/profil">Profil</a></li>
                    <li class="nav-item"><a class="nav-link" href="/zakazi_termin">Medicinske dokumentacije</a></li>
                    <li class="nav-item"><a class="nav-link text-warning fw-bold" href="/logout">Logout</a></li>
                </ul>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </nav>

    <!-- OVDE IDE SADRŽAJ KOJI SE MENJA -->
    <div class="container mt-4">
        {% block content %}

        <h2>Dobrodošli, {{ user }}!</h2>
        <p>Vaša uloga: <b>{{ role }}</b></p>

        {% if session['role'] == 'pacijent' %}
        <h2 class="text-center">Vaši termini</h2>

        <table class="table">

            <thead>
                <tr>
                    <th>ID</th>
                    <th>Datum</th>
                    <th>Vreme</th>
                    <th>Status</th>
                    <th>Opcije</th>
                </tr>
            </thead>
            <tbody>
                {% for t in termini %}
                <tr>
                    <td>{{t.idTermin}}</td>
                    <td>{{t.datum.strftime('%d-%m-%Y')}}</td>
                    <td>{{ t.datum.strftime('%H:00') }} – {{ (t.datum.hour + 1) }}:00</td>
                    {% if t.status == 'realizovan' %}
                    <td class="table-success">{{t.status}}</td>
                    {% endif %}
                    {% if t.status == 'zakazan' %}
                    <td class="table-warning">{{t.status}}</td>
                    {% endif %}
                    {% if t.status == 'otkazan' %}
                    <td class="table-danger">{{t.status}}</td>
                    {% endif %}
                    {% if t.status == 'zakazan' %}
                    <td>
                        <form method="POST" action="{{ url_for('otkazi_termin', termin_id=t.idTermin) }}"
                            onsubmit="return confirm('Da li ste sigurni da želite da otkažete termin?');">
                            <button class="btn btn-danger btn-sm">Otkaži</button>
                        </form>
                    </td>
                    {% else %}
                    <td>-</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% endif %}

        {% if session['role'] == 'stomatolog' %}
        <h1>Zakazani termini</h1>
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ime i prezime pacijenta</th>
                    <th>Telefon</th>
                    <th>Datum</th>
                    <th>Vreme</th>
                    <th>Alergije</th>
                    <th>Opcije</th>
                </tr>
            </thead>
            <tbody>
                {% for t in termini %}
                <tr>
                    <td>{{ t.idTermin }}</td>
                    <td>{{ t.pacijent.ime }} {{ t.pacijent.prezime }}</td>
                    <td>{{ t.pacijent.broj_telefona }}</td>
                    <td>{{ t.datum.strftime('%d-%m-%Y') }}</td>
                    <td>{{ t.datum.strftime('%H:00') }} – {{ t.datum.hour + 1 }}:00</td>
                    <td>{{ t.pacijent.alergije or 'Nema' }}</td>
                    <td>
                        <form method="POST" class="d-inline"
                            action="{{ url_for('stomatolog_otkazi_termin', termin_id=t.idTermin) }}"
                            onsubmit="return confirm('Da li ste sigurni da želite da otkazete termin?');">
                            <button class="btn btn-danger btn-sm">Otkaži</button>
                        </form>

                        <form action="{{ url_for('zavrsi_termin', termin_id=t.idTermin)}}" class="d-inline"
                            onsubmit="return confirm('Da li ste sigurni da želite da završite termin?');">
                            <button class="btn btn-success btn-sm">
                                Završi
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% endblock %}

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>